apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-kapt'
apply plugin: 'com.google.firebase.appdistribution'
apply plugin: 'com.google.gms.google-services'
apply plugin: 'com.google.firebase.crashlytics'
apply plugin: 'kotlin-parcelize'

android {

    packagingOptions {
        exclude("META-INF/*.kotlin_module")
    }

    compileSdkVersion rootProject.ext.TARGET_SDK_VERSION
    buildToolsVersion rootProject.ext.BUILD_TOOLS_VERSION

    defaultConfig {
        applicationId rootProject.ext.application_id
        minSdkVersion rootProject.ext.MIN_SDK_VERSION
        targetSdkVersion rootProject.ext.TARGET_SDK_VERSION
        versionCode getVersionMajor() * 10000 + getVersionMinor() * 1000 + getVersionPatch() * 100 + getVersionBuild()
        versionName "${getVersionMajor()}.${getVersionMinor()}.${getVersionPatch()}"

        multiDexEnabled true
        vectorDrawables.useSupportLibrary = true
        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
    }

    signingConfigs {
        debug {
            storeFile file("../keystore/debug.jks")
            storePassword "123456"
            keyAlias "debug"
            keyPassword "123456"
        }

        release {
            storeFile file("../keystore/release.jks")
            storePassword "QCNrnsLEH8DY6Har"
            keyAlias "pharmix"
            keyPassword "B2UnXxNXqXT65zgB"
        }
    }

    buildTypes {
        debug {
            firebaseAppDistribution {
                serviceCredentialsFile = "$project.rootDir/nauchat-app-distribution.json"
                groupsFile = "$project.rootDir/tester_groups.txt"
                releaseNotesFile = "$project.rootDir/releasenotes.txt"
            }
            versionNameSuffix "-DEBUG"
            signingConfig signingConfigs.debug
            debuggable true
        }
        release {
            firebaseAppDistribution {
                serviceCredentialsFile = "$project.rootDir/nauchat-app-distribution.json"
                groupsFile = "$project.rootDir/tester_groups.txt"
                releaseNotesFile = "$project.rootDir/releasenotes.txt"
            }
            minifyEnabled true
            //debuggable true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
            signingConfig signingConfigs.release
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = JavaVersion.VERSION_1_8
    }

    buildFeatures {
        viewBinding true
    }

}

dependencies {
    implementation 'androidx.test:core-ktx:1.3.0'
    def versionPowerMock = '1.7.3'
    def versionMockito = '2.8.9'

    implementation presentation.kotlin
    implementation presentation.ktxCore
    implementation ui.appcompat
    implementation ui.googleMaterial
    implementation ui.constraintLayout
    implementation ui.lifecycle
    implementation ui.lifecycleCommon
    implementation ui.localeChanger

    implementation ui.glide
    implementation ui.glideAnnotation
    kapt ui.glideProcessor

    implementation ui.cicerone
    implementation ui.firebaseCrashlytics
    implementation ui.dotsIndicator
    implementation ui.maskedEditText
    implementation ui.keyboardVisibility

    implementation ui.gmsPlayServicesAuth

    implementation presentation.moxy
    implementation presentation.moxyAndroid
    implementation presentation.moxyKtx
    kapt presentation.moxyCompiler

    implementation presentation.inject
    implementation presentation.toothpick
    implementation presentation.toothpickX
    implementation presentation.toothpickKtp
    implementation presentation.toothpickLifeCycle
    kapt presentation.toothpickCompiler


    implementation data.gson
    implementation data.retrofit
    implementation data.retrofitLogging
    implementation data.gsonConverter
    implementation data.retrofitRxJava

    implementation presentation.rxJavaKotlin
    implementation presentation.rxJava
    implementation presentation.rxJavaAndroid

    implementation lib.domain
    implementation lib.data

    testImplementation 'junit:junit:4.13.2'
    testImplementation 'org.mockito:mockito-core:1.10.19'
    testImplementation 'com.github.stephanenicolas.toothpick:toothpick-testing:2.1.0'
    testImplementation "org.mockito:mockito-core:$versionMockito"
    testImplementation "org.mockito:mockito-inline:$versionMockito"
    testImplementation "org.powermock:powermock-core:$versionPowerMock"
    testImplementation "org.powermock:powermock-module-junit4:$versionPowerMock"
    testImplementation "org.powermock:powermock-api-mockito2:$versionPowerMock"
    testImplementation ui.robolectric
    testImplementation "androidx.arch.core:core-testing:2.1.0"

}
